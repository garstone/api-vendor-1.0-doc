## REST-эндпоинты на стороны МоегоСклада 

Базовый URL REST-эндпоинтов со стороны МоегоСклада (далее будем называть его `MARKETPLACE-ENDPOINT`):

На текущий момент со стороны МоегоСклада есть следующие эндпоинты:

+ эндпоинт для обратного вызова по изменению статуса приложения на аккаунте
+ получение контекста пользователя для iframe-приложений

### Обратный вызов изменения статуса приложения на аккаунте

**Resource**: `MARKETPLACE-ENDPOINT/apps/{appId}/{accountId}/status`

Здесь

+ **appId** `UUID` - идентификатор приложения в Маркетплейсе 
+ **accountId** `UUID` - идентификатор аккаунта в МоемСкладе


HTTP-метод: **PUT**

Тело запроса:

+ **status** `String` - текущий актуальный статус приложения. Возможные значения: **Activating**, **SettingsRequired**, **Activated**.


МойСклад при обработке данного запроса проверяет возможность перехода приложения на аккаунте в требуемое состояние в 
соответствии с жизненным циклом приложения на аккаунте. При отсутствии перехода по жизненному циклу - ошибка. 
Если приложение на аккаунте уже находится в целевом состоянии - то ошибки нет.

Тело ответа: пустое (за исключением ошибок)

HTTP status codes:

+ **200 OK** - МойСклад перевел приложение на аккаунте в соответствующее переданному статусу состояние (или приложение 
уже находилось в требуемом состоянии)
+ **404 Not Found** - приложение не подключено на данном аккаунте
+ **409 Conflict** - в случае отсутствия соответствующего перехода по жизненному циклу приложения на аккаунте


> Пример

> **Request:** 

> **PUT**
> https://online.moyslad.ru/api/vendor/1.0/apps/5f3c5489-6a17-48b7-9fe5-b2000eb807fe/f088b0a7-9490-4a57-b804-393163e7680f

> Body 

```json
{
  "status": "Activating"
}
```
> ---

> **Response:** 

> Response 200

> Content-Type: **application/json**

### Получение контекста пользователя для iframe-приложений

Через этот эндпоинт можно получить информацию по пользователю, который загружает iframe-приложение в UI МоегоСклада. 
В URL, по которому загружается Iframe-приложение, добавляется GET-параметр `contextKey` - это одноразовый ключ, который 
может быть использован не более одного раза для получения контекста пользователя через данный эндпоинт. В случае 
повторного использования `contextKey` - эндпоинт вернет ошибку.

**Resource**: `MARKETPLACE-ENDPOINT/context/{contextKey}`

Здесь

+ **contextKey** `String` - одноразовый ключ, переданный ранее GET-параметром при загрузке iframe

HTTP-метод: **POST**

Тело запроса: пустое

Тело ответа:

В случае успешного ответа возвращается такое же по структуре содержимое как в `https://online.moysklad.ru/api/remap/1.2/context/employee`

В случае ошибок - JSON-объект с ошибкой.

HTTP status codes:

+ **200 OK** - все в порядке, в ответе отдается контекст пользователя
+ **403 Forbidden** - приложение не авторизовано на доступ по данному contextKey
+ **404 Not Found** - contextKey не найден
+ **409 Conflict** - приложение авторизовано, но данный contextKey уже отработал свой один раз

> Пример

> **Request:** 

> **POST**
> https://online.moysklad.ru/api/vendor/1.0/context/6S3BQLsaSRNdEnhPCoW9lplY2LozRUOq6S3BQLsaSRNdEnh

> ---

> **Response:** 

> Response 200

> Content-Type: **application/json**

> Response body

```json
{
  "status": "SettingsRequired"
}
```

