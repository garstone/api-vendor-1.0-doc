## Общая информация

В данном разделе можно узнать:

- какие бывают приложения в Маркетплейсе
    - по техническому типу
    - по платности
- как создать свое приложение

### Типы приложений в Маркетплейсе

Тип приложения определяет в первую очередь технический способ интеграции приложения с МоимСкладом.

Поддерживаемые на текущий момент типы приложений:

+ Телефония (Phone API)
+ Iframe-приложения
+ Серверные приложения
+ Интеграция с системами лояльности (Loyalty API)

### Сводная таблица поддержки функций для типов приложений

| Тип приложения | Количество приложений на аккаунте | Iframe и доступ к контексту пользователя | Активация и деактивация по Vendor API | Доступ по токену к JSON API 1.2 | Отладка на аккаунтах разработчика | Phone API | Loyalty API | Блок на витрине приложений 
|----|----|----|----|----|----|----|----|----|
|Телефония|1| | | |+|+| | Звонки |  
|Iframe-приложения|Не ограничено|+|  | | + | | |Новые|  
|Серверные приложения|Не ограничено|+|+|+|+| | |Новые|  
|Системы лояльности|1| | | | | |+|Скидки|  



### Серверные приложения

Серверные приложения - это приложения, основной функционал которых основан на обмене данными с МоимСкладом по JSON API.
 Для этого при активации приложения по Vendor API на сервер вендора передается [токен доступа к JSON API 1.2](#dostup-po-tokenu-k-json-api) 
 (доступ по токену поддерживается только в JSON API 1.2).
 
Для серверных приложений поддерживается активация и деактивация по Vendor API.

Для серверных приложений доступно получение контекста текущего пользователя МоегоСклада (через Vendor API) - 
 то есть можно узнать, какой именно пользователь какого аккаунта открывает приложение в UI МоегоСклада.

Также серверное приложение может иметь свою вкладку среди iframe-приложений и пользовательский интерфейс. Используя 
 данную возможность можно, например, реализовать управление настройками приложения со стороны пользователя 
 МоегоСклада / администратора аккаунта. Поддерживается возможность расширенного iframe-окна (подробнее см. [дескриптор](#blok-iframe)).
 
 В общем случае жесткие требования к внешнему виду / визуальному дизайну iframe-части приложений отсутствуют. 
 Тем не менее, приветствуется визуальное соответствие дизайну МоегоСклада. Для этого мы разработали 
 UI Kit (см. скриншот), который доступен по ссылке [https://github.com/moysklad/html-marketplace-1.0-uikit](https://github.com/moysklad/html-marketplace-1.0-uikit).
 
 
 ![useful image](ui-kit.png)
 
Одновременно на аккаунте может быть подключено несколько серверных приложений.

Доступна отладка на аккаунтах разработчика.


### Iframe-приложения

Iframe-приложение представляет собой веб-приложение, которое загружается по указанному вендором URL в iframe на 
отдельной вкладке/странице внутри UI МоегоСклада.

Iframe-приложения просты в разработке и размещении на площадке МоегоСклада, однако такие приложения тоже должны 
соответствовать [требованиям к приложениям](#trebowaniq-k-prilozheniqm).

Для iframe-приложений поддерживается доступ к контексту пользователя и расширение окна iframe, однако **не поддерживается** 
активация и деактивация по Vendor API, а также доступ по токену к JSON API 1.2. 

При построении пользовательского интерфейса в iframe-приложениях также желательно использовать [UI Kit МоегоСклада](https://github.com/moysklad/html-marketplace-1.0-uikit).

Одновременно на аккаунте может быть подключено несколько iframe-приложений.

Доступна отладка на аккаунтах разработчика.


### Телефония

Эти приложения представляют собой интеграцию с внешними сервисами телефонии по Phone API: 
[https://online.moysklad.ru/api/phone/1.0/doc/index.html](https://online.moysklad.ru/api/phone/1.0/doc/index.html)

Приложения телефонии на витрине приложений размещаются в блоке “Звонки”.

На текущий момент возможность получения доступа по токену к JSON API у приложений телефонии отсутствует, как и 
возможность активации и деактивации приложений телефонии по Vendor API (в перспективе такая возможность может 
появиться).

Одновременно на аккаунте может быть подключено только одно приложение телефонии.

Доступна отладка на аккаунтах разработчика.

### Интеграция с системами лояльности

API для интеграции МоегоСклада с системами лояльности и внешними сервисами управления скидками: 
[https://msloyaltyapi.docs.apiary.io](https://msloyaltyapi.docs.apiary.io)
 
Данный тип приложений размещается на витрине в отдельном блоке “Скидки”.

Одновременно на аккаунте может быть подключено только одно приложение интеграции с системами лояльности.
 
На текущий момент для данного типа приложений недоступны возможности Маркетплейса (iframe, Vendor API,
 доступ по токену к JSON API, отладка на аккаунтах разработчика), так как данный тип приложений еще не заведен на 
 механизмы Маркетплейса (но возможно ручное размещение приложений данного типа на витрине приложений).

### Платные и бесплатные приложения

На текущий момент в Маркетплейсе поддерживаются как бесплатные, так и платные приложения. 

Бесплатные приложения могут быть установлены пользователями на аккаунте вне зависимости от типа подписки (с 
ограничениями на Бесплатном тарифе) и в любом количестве.  Тем не менее, вендор может брать оплату с пользователей 
приложений самостоятельно. Конкретный механизм самостоятельного взимания оплаты и его реализация остается на усмотрение 
вендора и не рассматривается в данном документе.

Для платных приложений в системе МойСклад на данный момент доступен только один фиксированный вариант стоимости - 
500 рублей в месяц. Эта оплата взимается с пользователей в виде платной опции в рамках их подписки на МойСклад, 
поэтому здесь так же, как на подписку, для пользователей применяются скидки за оплату на 3, 6 и 12 месяцев.

Также мы написали для пользователей подробную инструкцию по тому, как устанавливать и оплачивать приложения. Вы можете 
посмотреть ее [здесь](https://support.moysklad.ru/hc/ru/articles/360039880573-%D0%9F%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F). 

Вендор получает 75% от стоимости своих приложений без учета скидок и комиссий. Например, если приложение стоимостью 
500 руб было оплачено на 3 месяца, вендор будет получать  500 * 0,75 = 375 рублей ежемесячно.
 
В дальнейшем возможно изменение доли вендора в ту или иную сторону.

В дальнейшей перспективе будет реализован более гибкий биллинг приложений Маркетплейса, не привязанный в общем случае 
к подписке на МойСклад и в том числе позволяющий устанавливать вендорам произвольную стоимость приложений.

### Жизненный цикл приложения

На текущий момент для приложения Маркетплейса предусмотрены следующие статусы жизненного цикла:

* **Черновик** (_Draft_) - статус черновика, предназначен для разработки и тестирования, приложение не отображается на витрине
 у пользователей МоегоСклада.
* **Готово, отправлено на модерацию** (_Ready_) - статус готовности, означает, что приложение со стороны вендора готово к 
публикации (далее приложение будет 
промодерировано сотрудниками МоегоСклада и опубликовано), приложение все еще не отображается на витрине у пользователей 
МоегоСклада.
* **Опубликовано** (_Published_) - приложение опубликовано на витрине приложений и доступно к установке пользователями МоегоСклада.
* **Снято с публикации** (_Suspended_, скоро будет переименован в _Hidden_) - публикация приложения приостановлена. Приложение в статусе 
Suspended исчезает с витрины, но установленные на аккаунтах приложения продолжают работать.


Жизненный цикл приложения выглядит следующим образом:

1. Приложение создается в [Личном кабинете вендора](#lichnyj-kabinet-wendora) со статусом Draft. Вендор проверяет и отлаживает работу 
приложения на аккаунте разработчика. По готовности приложения вендор передает его на публикацию, 
статус приложения меняется на Ready.
2. Сотрудники МоегоСклада проверяют приложение и, в случае отсутствия замечаний, публикуют приложение на витрине,
 статус приложения меняется на Published. Приложение становится доступно для установки пользователями МоегоСклада.
3. Пользователи МоегоСклада подключают/устанавливают приложение на свой аккаунт, выполняют его настройку 
(если таковая опция имеется в приложении), пользуются приложением и, если оно становится ненужным, отключают/удаляют 
приложение с аккаунта. 
4. Если по каким-то причинам приложение требуется убрать с витрины приложений, то оно переводится в статус Suspended 
(Hidden). Установленные до этого момента экземпляры приложений на аккаунтах продолжают работать.
