## Разработка и публикация приложений 

Краткая инструкция по разработке, отладке и публикации приложений на примере iframe- и серверных приложений.

### Разработка серверных приложений

При разработке серверного приложения следует определиться по следующим вопросам:

* Должен ли будет пользователь настраивать приложение при его установке на аккаунт? Если да - то нужно реализовать 
iframe-часть для серверного приложения, по возможности используя UI Kit МоегоСклада.
 
* Будет ли в iframe-части серверного приложения какой-либо пользовательский функционал, кроме настроек? Если да - то,
 возможно, следует предусмотреть, чтобы пользовательский функционал был доступен не только администратору аккаунта 
 (как, например, настройки), но и другим пользователям аккаунта (всем или с определенными правами). 
 
* Нужны ли дополнительные поля для сущностей и/или документов? Если да - то можно будет их создавать через JSON API 
1.2 в рамках активации приложения. Здесь скорее всего потребуется использовать сценарий асинхронной активации 
(с возвратом статуса Activating).

Также заметим, что для серверных приложений является обязательным реализация эндпоинта /api/moysklad/vendor/1.0/apps 
(см. [Vendor API](https://dev.moysklad.ru/doc/api/vendor/1.0/)) на стороне вендора, и предполагается, что 
серверное приложение будет взаимодействовать с МоимСкладом по JSON API 1.2 с авторизацией по токену (передаваемому 
приложению по Vendor API при активации).

### Разработка iframe-приложений

При разработке iframe-приложения вендору следует определиться по следующим вопросам:

* Насколько будет использоваться [UI Kit МоегоСклада](https://github.com/moysklad/html-marketplace-1.0-uikit) для 
построения пользовательского интерфейса содержимого iframe? Приветствуется использование UI Kit МоегоСклада.

### Личный кабинет вендора 

Для упрощения и автоматизации работы над приложениями Маркетплейса был создан **Личный кабинет вендора**. Это сервис, 
который позволяет вендорам самостоятельно создавать приложения в статусе _Draft_, 
отлаживать и тестировать их на витрине приложений, вносить необходимые изменения (в том числе самостоятельно получать и 
изменять SecretKey) и, по окончании разработки, отправлять на модерацию в МойСклад. 

Что можно делать в личном кабинете:
 
- Создавать Черновики приложений. Можно завести:
    - Серверное приложение
    - Телефонию
    - Iframe-приложение
- Редактировать Черновики приложений и просматривать информацию о приложениях в прочих статусах
- Редактировать информацию о разработчике 
    - функция доступна, пока на аккаунте отсутствуют приложения или есть только Черновики. В остальных случаях для 
    изменения информации следует обратиться к модератору МоегоСклада.
- Отправлять Черновики приложений на модерацию
- Следить за статусами публикации своих приложений

Для получения доступа в Личный кабинет следует заполнить [анкету](https://partners.moysklad.ru/developers/#register) или, 
если вы уже являетесь Вендором, обратиться к сотруднику МоегоСклада.

### Карточка вендора

Карточка вендора - это Google Sheets таблицы, через которые происходил обмен информацией между вендором и 
МоимСкладом до создания Личного кабинета.

На данный момент карточка не используется.

### Отладка приложений на аккаунтах разработчика

Отладка неопубликованных приложений выполняется вендором на специальном аккаунте(ах), привязанных к вендору. 

На таких аккаунтах неопубликованные приложения вендора появляются в специальном блоке на витрине приложений 
"ПРИЛОЖЕНИЯ В РАЗРАБОТКЕ". Для остальных пользователей приложения-черновики не будут видны. 

Неопубликованные приложения можно подключать и отключать так же, как и обычные опубликованные приложения.

Привязка аккаунтов к вендору осуществляется через сотрудника МоегоСклада.  

### Общая схема процесса размещения приложения в Маркетплейсе

После готовности приложения на стороне вендора в общем случае вендору нужно выполнить следующие шаги по размещению 
приложения в Маркетплейсе:

1. Создать Черновик приложения в Личном кабинете вендора.
2. После создания Черновика на странице редактирования приложения будет доступен [Секретный ключ](#sekretnyj-kluch-secretkey) (Secret Key).
3. Убедиться, что у него уже есть [аккаунт разработчика](#otladka-prilozhenij-na-akkauntah-razrabotchika) 
в МоемСкладе, или обратиться к сотруднику МоегоСклада для привязки.
4. Протестировать и отладить приложение на аккаунте разработчика.
5. Отправить приложение на модерацию через Личный кабинет вендора.
6. Сотрудник МоегоСклада смотрит на приложение и, при отсутствии замечаний, публикует его на витрине приложений.


### Требования к иконкам приложений

При разработке иконки, которая будет отображаться на витрине приложений, нужно ориентироваться на следующие требования:

1. **Отчетливая крупная форма отчетливого цвета**. Иконка будет на белом фоне и может теряться если в ней будут мелкие 
детали на белом фоне. К тому же один крупный знак будет просто и понятно восприниматься.
2. **Не делайте иконку без фона**, если только она не заполняет выделенное пространство плотно, иначе она будет «исчезать» 
на фоне других иконок. 
3. **Не ставьте скриншоты и фотографии и элементы интерфейса**. Фотографии и экраны приложений могут включать много ненужных и плохо различичмых деталей. Детали интерфейса могут быть обманчивыми и путающими человека.
4. **По возможности не используйте слова.** Используйте знак вашего логотипа, если у вас есть отдельный. Если используете 
какую-то букву из вашего логотипа как знак, то можно использовать его. Если вы так не делаете, то можно поставить полное 
название, учитывая все остальные пункты.
5. **Не ставьте логотип МоегоСклада или его имитации.** Указать наш логотип значит сказать, что мы как-то учавствовали в 
разработке приложения, что будет неправдой.
6. **Размер иконки 90x90**. Можно использовать все это пространство и не оставлять внутренних белых рамок.

![useful image](logo_instruction.png)

### Демо-приложение

Для демонстрации взаимодействия приложений с Маркетплейсом МоегоСклада было создано демо-приложение на PHP.

В демо-приложении реализованы следующие функции:

* Активация (с получением токена доступа к JSON API 1.2) и деактивация по Vendor API.
* Использование iframe для настройки приложения администратором аккаунта с обновлением статуса в Маркетплейсе.
* Получение контекста пользователя для iframe (отображение информации по пользователю, проверка прав администратора).
* Получение информации из МоегоСклада по JSON API 1.2 с доступом по токену.

Более подробную информацию и исходный код приложения можно получить по ссылке: [https://github.com/moysklad/php-dummyapp-marketplace-1.0](https://github.com/moysklad/php-dummyapp-marketplace-1.0)
